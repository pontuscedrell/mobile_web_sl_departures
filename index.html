<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Avgångar från Årstaberg</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: "Segoe UI", Roboto, sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
    }

    .container {
      display: flex;
      flex-direction: row;
      height: 100%;
      width: 100%;
    }

    .column {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 5vw;
      box-sizing: border-box;
      border-left: 2px solid #222;
    }

    .column:first-child {
      border-left: none;
    }

    .title {
      font-size: 4vw;
      color: #888;
      margin-bottom: 3vh;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .minutes {
      font-size: 14vw;
      font-weight: bold;
      color: #0f0;
      text-shadow: 0 0 10px #0f0;
      margin-bottom: 2vh;
    }

    .destination {
      font-size: 5vw;
      text-align: center;
      color: #fff;
      max-width: 90%;
      line-height: 1.2;
    }

    @media (orientation: portrait) {
      body::before {
        content: "Vrid mobilen till liggande läge";
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 2rem;
        color: #ccc;
        text-align: center;
        background-color: #111;
        padding: 1.5rem;
        border-radius: 10px;
        box-shadow: 0 0 20px #000;
      }

      .container {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="column">
      <div class="title">Tvärbanan</div>
      <div class="minutes" id="tvarbanan-time">–</div>
      <div class="destination" id="tvarbanan-dest">Laddar...</div>
    </div>
    <div class="column">
      <div class="title">Pendeltåg</div>
      <div class="minutes" id="pendeltag-time">–</div>
      <div class="destination" id="pendeltag-dest">Laddar...</div>
    </div>
  </div>

  <script>
    const API_URL = "https://transport.integration.sl.se/v1/sites/9531/departures";

    function getMinutesUntil(timeStr) {
      const now = new Date();
      const departureTime = new Date(timeStr);
      const diff = Math.floor((departureTime - now) / 60000);
      return diff <= 0 ? "Nu" : `${diff} min`;
    }

    function findNextDeparture(data, groupOfLines, directionCodes) {
      return data.departures
        .filter(d =>
          d.line?.group_of_lines === groupOfLines &&
          directionCodes.includes(d.direction_code) &&
          d.stop_area?.name === "Årstaberg"
        )
        .sort((a, b) => new Date(a.expected) - new Date(b.expected))[0];
    }

    function updateDisplay(pendeltag, tvarbanan) {
      const pDest = document.getElementById("pendeltag-dest");
      const pTime = document.getElementById("pendeltag-time");
      const tDest = document.getElementById("tvarbanan-dest");
      const tTime = document.getElementById("tvarbanan-time");

      if (pendeltag) {
        pTime.textContent = getMinutesUntil(pendeltag.expected);
        pDest.textContent = pendeltag.destination;
      } else {
        pTime.textContent = "–";
        pDest.textContent = "Ingen avgång";
      }

      if (tvarbanan) {
        tTime.textContent = getMinutesUntil(tvarbanan.expected);
        tDest.textContent = tvarbanan.destination;
      } else {
        tTime.textContent = "–";
        tDest.textContent = "Ingen avgång";
      }
    }

    function fetchDepartures() {
      fetch(API_URL)
        .then(res => res.json())
        .then(data => {
          const pendeltag = findNextDeparture(data, "Pendeltåg", [0, 2]);
          const tvarbanan = findNextDeparture(data, "Tvärbanan", [1]);
          updateDisplay(pendeltag, tvarbanan);
        })
        .catch(err => {
          console.error("Fel vid hämtning:", err);
          document.getElementById("pendeltag-dest").textContent = "Fel";
          document.getElementById("tvarbanan-dest").textContent = "Fel";
        });
    }

    fetchDepartures();
    setInterval(fetchDepartures, 30000); // uppdatera var 30:e sekund
  </script>
</body>
</html>
